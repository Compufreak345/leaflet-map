<link rel="import" href="leaflet-core.html">
<link rel="import" href="leaflet-popup.html">

<dom-module id="leaflet-rectangle">
    <style>
        :host{ display: none; }
    </style>
    <template><content></content>
    </template>
</dom-module>

<script>
    "use strict";
    Polymer({
        is: 'leaflet-rectangle',
        // TODO: Implement complete inheritance from Polygon <- Polyline <- Path
        behaviors: [leafletMap.LeafletPath, leafletMap.LeafletPopupContent],
        /**
         * A Leaflet [Rectangle] object
         *
         * @property feature
         * @type L.rectangle
         * @default null
         */
        feature: null,
        properties: {
            container: {
                type: Object,
                observer: '_containerChanged'
            },

            /**
             * The `northEast` attribute sets the positions of the north east corner of the rectangle.
             *
             * @attribute latitude
             * @type number
             */
            northEast : {
                type: Object,
                value : null,
                reflectToAttribute:true,
                notify:true,
                observer:'_boundsChanged'
            },
            /**
             * The `southWest` attribute sets the positions of the southWest corner of the rectangle.
             *
             * @attribute latitude
             * @type number
             */
            southWest : {
                type: Object,
                value : null,
                reflectToAttribute:true,
                notify:true,
                observer:'_boundsChanged'
            }
        },
        _containerChanged: function() {
            if (this.container) {
                // define rectangle geographical bounds
                var bounds = [this.southWest,this.northEast];
                this.feature = L.rectangle(bounds, this.getPathOptions());
                // forward events
                this.feature.on('click dblclick mousedown mouseover mouseout contextmenu dragstart drag dragend move add remove popupopen popupclose', function(e) {
                    this.fire(e.type, e);
                }, this);

                this.updatePopupContent();
                this.feature.addTo(this.container);
            }
        },
        _boundsChanged: function(newVal) {
            if(this.feature && newVal) {
                this.feature.setBounds([this.southWest,this.northEast]);
            }
        },
        detached: function() {
            if (this.container && this.feature) {
                this.container.removeLayer(this.feature);
            }
        }
    });
</script>


